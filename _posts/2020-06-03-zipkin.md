---
layout: post
title: Spring cloud集成Zipkin链路
# gh-repo: daattali/beautiful-jekyll
# gh-badge: [star, fork, follow]
tags: [spring,zipkin,elasticsearch]
comments: true
---



### 启动zipkin

**用elasticsearch的方式启动**

QUERY_PORT=9411 STORAGE_TYPE=elasticsearch ES_HOSTS=http://localhost:9200 java -jar zipkin.jar

后台启动

QUERY_PORT=9411 STORAGE_TYPE=elasticsearch ES_HOSTS=http://localhost:9200 nohup java -jar zipkin.jar &



### 启动elasticsearch

后台启动

./elasticsearch -d



### 查询elasticsearch数据

curl -s 'localhost:9200/zipkin*span-2017-08-11/_search?q=_q:error=500'

curl -s 'localhost:9200/zipkin*span-2020-05-21/_search'

curl -s 'localhost:9200/zipkin*/_search'

查看elasticsearch的所有索引   
curl http://localhost:9200/_cat/indices?v

### elasticsearch数据定时删除
上线以后数据急速增加，一天大概3000万的文档，造成zipkin查询很慢，有的时候会报错。  
解决办法：
1. 定时删除不需要的数据
2. 修改zipkin采样率，改成0.1

